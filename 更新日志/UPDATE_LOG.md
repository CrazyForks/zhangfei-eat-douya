# 更新日志

## 主要改进

### 1. 多页面架构
- **写作页面** (`/`): 专门用于文章生成
- **配置页面** (`/config`): 集中管理所有配置项
- **历史记录页面** (`/history`): 查看所有生成的文档

### 2. 自定义 Prompt 功能
- 在配置页面可以设置默认写作提示词
- 在写作页面可以临时使用自定义提示词
- 使用 `{topic}` 作为标题的占位符
- 示例提示词：
  ```
  请根据标题"{topic}"写一篇专业的技术博客文章，要求结构清晰，内容深入，字数在1500字左右。
  ```

### 3. 图片生成优化
- 添加"生成文章配图"开关，可以选择是否生成配图
- 修复了图片下载和插入到 Word 的逻辑
- 图片会居中显示在文章标题之后
- 如果 Unsplash API 未配置或图片下载失败，会显示提示但不影响文章生成

### 4. Word 文档格式修复
- **完全去除 Markdown 格式**
  - 自动清理 `**粗体**`、`*斜体*`、`# 标题` 等 Markdown 标记
  - 在 Prompt 中要求 AI 使用纯文本格式

- **优化文档排版**
  - 标题居中显示
  - 图片居中显示，宽度为 5.5 英寸
  - 正文字体：宋体 12pt
  - 行间距：1.5 倍
  - 段后间距：6pt

### 5. 用户体验改进
- 导航栏可以快速切换不同页面
- 配置页面可以独立管理，不影响写作流程
- 历史记录页面可以查看和下载所有生成的文档
- 状态消息提示更加清晰

## 使用指南

### 首次使用
1. 访问 `http://127.0.0.1:5000`
2. 点击顶部导航栏的"配置"
3. 输入必要的配置：
   - Gemini API Key（必需）
   - Gemini Base URL（可以使用自定义代理）
   - Unsplash Access Key（可选，用于生成配图）
   - 默认写作提示词（可选）
4. 点击"保存配置"

### 生成文章
1. 回到"写作"页面
2. 输入文章标题（可以输入多个，每行一个）
3. 选择模型
4. （可选）输入自定义提示词
5. 选择是否生成配图
6. 点击"开始生成"
7. 等待生成完成，点击"下载 Word 文档"

### 查看历史
1. 点击"历史"页面
2. 查看所有生成的文档
3. 可以重新下载任何历史文档

## 技术细节

### 后端改进
- 支持自定义 Base URL，使用 HTTP 请求调用 API
- 添加图片生成开关，减少不必要的 API 调用
- 优化 Word 文档生成逻辑，自动清理 Markdown 格式
- 添加历史记录 API

### 前端改进
- 分离页面和 JavaScript 文件
- 使用模板继承（layout.html）
- 改进状态提示和错误处理

## 文件结构

```
write/
├── app.py                    # Flask 应用（已更新）
├── requirements.txt          # Python 依赖
├── config.json              # 配置文件（自动生成）
├── static/
│   ├── style.css           # 样式文件（已更新）
│   ├── write.js            # 写作页面 JS（新增）
│   ├── config.js           # 配置页面 JS（新增）
│   └── history.js          # 历史记录页面 JS（新增）
├── templates/
│   ├── layout.html         # 基础模板（新增）
│   ├── write.html          # 写作页面（新增）
│   ├── config.html         # 配置页面（新增）
│   └── history.html        # 历史记录页面（新增）
└── output/                  # 生成的文档输出目录
```

## 已修复的问题

1. ✅ 不同功能现在分成不同页面
2. ✅ 用户可以自定义 Prompt
3. ✅ 图片生成和插入问题已修复
4. ✅ Word 文档不再包含 Markdown 格式
5. ✅ 支持自定义 Base URL
6. ✅ 配置管理更加友好

## 下一步建议

- 可以添加文档预览功能
- 可以添加批量删除历史记录功能
- 可以添加文档模板选择功能
- 可以添加更多图片来源（不仅限于 Unsplash）
